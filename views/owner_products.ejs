<%- include('./partials/header') %>



<div class="w-full min-h-screen bg-gray-100 py-16 px-4 md:px-16">
  <h1 class="text-4xl font-bold mb-8 text-gray-800">Your Products</h1>

  <div class="mb-6">
    <a href="/owner/admin" 
       class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-indigo-700 transition">
      + Add New Product
    </a>
  </div>

  <% if (!products || products.length === 0) { %>
    <div class="bg-white p-10 rounded-xl shadow-lg text-center">
      <h2 class="text-2xl font-bold text-gray-700 mb-3">No Products Found ðŸ˜”</h2>
      <a href="/owner/add-product" class="text-indigo-600 font-semibold">Add a Product</a>
    </div>
  <% } else { %>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% products.forEach(product => { %>
        <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col">
          
          <!-- Product Image -->
          <div class="h-48 flex items-center justify-center bg-gray-100 rounded-xl mb-4">
            <% if (product.image) { %>
              <img src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" 
                   class="max-h-full object-contain" alt="<%= product.name %>">
            <% } else { %>
              <span class="text-gray-400">No Image</span>
            <% } %>
          </div>
          
          <!-- Product Info -->
          <h2 class="text-xl font-bold text-gray-800 mb-1"><%= product.name %></h2>
          <p class="text-gray-500 mb-1">Category: <%= product.category || 'N/A' %></p>
          <p class="text-gray-500 mb-1">Brand: <%= product.brand || 'N/A' %></p>
          <p class="text-gray-500 mb-1">Stock: <%= product.stock %></p>

          <% 
            const finalPrice = product.discount > 0 
                               ? Math.max(product.price - (product.price * product.discount / 100), 0)
                               : product.price; 
          %>

          <!-- Price Wrapper to keep alignment consistent -->
          <div class="mb-2 min-h-[3rem] flex flex-col justify-center">
            <% if (product.discount > 0) { %>
              <p class="text-gray-400 line-through">â‚¹ <%= product.price %></p>
              <p class="text-green-600 font-semibold">
                â‚¹ <%= finalPrice %> (<%= product.discount %>% OFF)
              </p>
            <% } else { %>
              <!-- Reserve space for strikethrough even if no discount -->
              <p class="text-gray-400 invisible">â‚¹ 0</p>
              <p class="text-gray-900 font-bold">â‚¹ <%= product.price %></p>
            <% } %>
          </div>
          
          <!-- Actions -->
          <div class="mt-auto flex gap-2">
            <a href="/owner/products/edit/<%= product._id %>" 
               class="flex-1 bg-yellow-500 text-white py-2 rounded-lg text-center hover:bg-yellow-600 transition">
              Edit
            </a>
            <form action="/owner/products/delete/<%= product._id %>" method="POST" class="flex-1">
              <button type="submit" 
                      class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition">
                Delete
              </button>
            </form>
          </div>
          
          <p class="text-xs text-gray-400 mt-2">
            Created: <%= new Date(product.createdAt).toLocaleDateString() %>
          </p>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<%- include('./partials/footer') %>
